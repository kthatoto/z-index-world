<!doctype html>
<html lang="ja">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>Layers 3D Planes (Floor + Walls)</title>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
      }

      /* 視点（親） */
      .viewport {
        height: 100%;
        display: grid;
        place-items: center;
        background: #111;
        perspective: 900px; /* ここが重要: 3D投影 */
        overflow: hidden;
      }

      /* 3D空間（子孫に3D変換を伝播） */
      .stage {
        position: relative;
        width: 520px;
        height: 320px;
        transform-style: preserve-3d; /* ここが重要 */
        /* ちょっと斜め上から見下ろす */
        transform: rotateX(65deg) rotateZ(0deg);
      }

      /* 共通: 3Dの「板」 */
      .plane {
        position: absolute;
        left: 50%;
        top: 50%;
        transform-style: preserve-3d;
        width: 520px;
        height: 320px;
        margin-left: -260px;
        margin-top: -160px;

        /* レイヤー化させやすいように */
        will-change: transform;
        backface-visibility: hidden;

        /* 見やすさ */
        outline: 1px solid rgba(255,255,255,0.25);
        background: rgba(255,255,255,0.05);
      }

      /* 床: X回転で寝かせた板 */
      .floor {
        transform: translateZ(0px);
      }

      /* 壁: Y回転で立てる（床の端に合わせる） */
      .wall {
        width: 520px;
        height: 160px;
        margin-left: -260px;
        margin-top: -80px;
        background: rgba(0, 200, 255, 0.10);
        outline: 1px solid rgba(0, 200, 255, 0.35);
      }

      /* 奥の壁（上端側）: X方向に立てる */
      .wall-back {
        /* 床の「上端」に配置して、X回転で垂直にする */
        transform:
          translateY(-160px)     /* 上へ（床上端まで） */
          translateZ(80px)       /* 少し手前に出して見やすく */
          rotateX(90deg);
        transform-origin: center center;
      }

      /* 左壁 */
      .wall-left {
        transform:
          translateX(-260px)     /* 左端へ */
          translateZ(80px)
          rotateY(90deg);
        transform-origin: center center;
      }

      /* 右壁 */
      .wall-right {
        transform:
          translateX(260px)      /* 右端へ */
          translateZ(80px)
          rotateY(-90deg);
        transform-origin: center center;
      }

      /* デモ用: 浮いてるカード（Z分離がLayersで見える） */
      .card {
        position: absolute;
        left: 50%;
        top: 50%;
        width: 180px;
        height: 90px;
        margin-left: -90px;
        margin-top: -45px;
        transform-style: preserve-3d;
        transform: translateZ(140px) rotateX(-20deg);
        background: rgba(255, 255, 255, 0.10);
        outline: 1px solid rgba(255,255,255,0.35);
        border-radius: 10px;
        display: grid;
        place-items: center;
        color: #fff;
        will-change: transform;
        backface-visibility: hidden;
      }

      /* 説明UI（2D） */
      .hud {
        position: fixed;
        left: 12px;
        bottom: 12px;
        color: #ddd;
        background: rgba(0,0,0,0.55);
        border: 1px solid rgba(255,255,255,0.15);
        padding: 10px 12px;
        border-radius: 10px;
        font-size: 13px;
        line-height: 1.4;
      }
      .hud code { color: #9ff; }
    </style>
  </head>
  <body>
    <div class="viewport">
      <div class="stage" id="stage">
        <!-- 床 -->
        <div class="plane floor"></div>

        <!-- 壁（3枚） -->
        <div class="plane wall wall-back"></div>
        <div class="plane wall wall-left"></div>
        <div class="plane wall wall-right"></div>

        <!-- 浮いてる要素 -->
        <div class="card" id="card">translateZ(140px)</div>
      </div>
    </div>

    <div class="hud">
      DevTools → <b>Layers</b> で確認してね。<br/>
      重要: <code>perspective</code> / <code>preserve-3d</code> / <code>rotateX|Y</code> / <code>translateZ</code><br/>
      操作: マウスドラッグでステージ回転
    </div>

    <script>
      // ステージ回転（視覚確認用。Layersにも反映される）
      const stage = document.getElementById("stage");
      let dragging = false;
      let lastX = 0, lastY = 0;
      let rx = 65, ry = 0;

      const apply = () => {
        stage.style.transform = `rotateX(${rx}deg) rotateY(${ry}deg)`;
      };
      apply();

      window.addEventListener("mousedown", (e) => {
        dragging = true;
        lastX = e.clientX;
        lastY = e.clientY;
      });
      window.addEventListener("mouseup", () => dragging = false);
      window.addEventListener("mousemove", (e) => {
        if (!dragging) return;
        const dx = e.clientX - lastX;
        const dy = e.clientY - lastY;
        lastX = e.clientX;
        lastY = e.clientY;

        ry += dx * 0.25;
        rx -= dy * 0.25;
        rx = Math.max(5, Math.min(85, rx));
        apply();
      });
    </script>
  </body>
</html>
